const ieInfiniteScroll={allStories:[],showedStories:[],allStoriesIds:[],showedStoriesIds:[],nextStoryUrl:"",nextStoryId:"",processingAjax:!1,currentVisibleId:null,totalNextStories:0,browserUrl:"",totalAjaxHit:0,isSubscriber:!1,seoMeta:[],ieAdCodes:[],adCounter:0,shortCodeCss:!1,audioCodeCss:!1,instagramJs:!1,recommededlogic:!1,init:function(){let e=this.getCookie("ie_userdata");void 0!==e&&""!==e&&void 0!==(e=JSON.parse(e)).subscription_plan&&Array.isArray(e.subscription_plan)&&e.subscription_plan.includes("Digital Subscriber")&&(this.isSubscriber=!0),"undefined"!=typeof ieInfiniteScrollDetails&&"undefined"!=typeof DOMPurify&&!0===this.isSubscriber&&("true"===ieInfiniteScrollDetails.new_recommended_api?(this.recommededlogic=!0,this.initasync()):this.initsync())},initsync:function(){this.parseAdCodes(),this.initiateNextStorySeoMeta(ieInfiniteScrollDetails.current_postid),this.initiateInfiniteScroll(),this.removeWidgets(),$this.removeSidebarWidgets("pageload",ieInfiniteScrollDetails.current_postid)},initasync:async function(){this.parseAdCodes(),this.initiateNextStorySeoMeta(ieInfiniteScrollDetails.current_postid),await this.hit_recommended_api(ieInfiniteScrollDetails.current_postid),this.initiateInfiniteScroll(),this.removeWidgets(),$this.removeSidebarWidgets("pageload",ieInfiniteScrollDetails.current_postid)},initiateInfiniteScroll:function(){$this=this,1===jQuery(".pdsc-related-modify").length&&($this.shortCodeCss=!0),1===jQuery(".audio-player-tts-sec").length&&($this.audioCodeCss=!0),$this.currentVisibleId=ieInfiniteScrollDetails.current_postid,$this.allStories=ieInfiniteScrollDetails.posts_url,$this.allStoriesIds=ieInfiniteScrollDetails.posts_ids,$this.totalNextStories=$this.allStories.length,$this.setObserverPattern(document.querySelector(".iestory_"+$this.currentVisibleId)),$this.updateState("load"),jQuery(window).on("scroll",function(){$this.debounce($this.processScroll,100)})},trackReadMoreWidgetOnInfiniteScroll:function(e){$this=this,implyEventType="nanu";var t={};void 0!==window.psdkvar&&(t.e1="appear",t.e3=ieInfiniteScrollDetails.section,t.fpuuid=$this.getImplyPluuidFromCookie(),t.pageUrl=$this.seoMeta[e].og_url,t.storyId=$this.seoMeta[e].post_id,t.eventName="read_more",t.eventType=implyEventType,window.psdkvar.eventCapture(t))},getImplyPluuidFromCookie:function(){let e="pluuid=",t=document.cookie.split(";"),r=t.length;for(let o=0;o<r;o++){let n=t[o];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return""},processScroll:function(){var e=document.getElementById("section"),t=jQuery(window).scrollTop(),r=jQuery(e).offset().top,o=jQuery(e).outerHeight();t>=r+o-window.innerHeight&&!1===$this.processingAjax&&0<$this.totalNextStories&&($this.processingAjax=!0,$this.getNextStory())},debounce:function(e,t){$this=this,clearTimeout(e._tId),e._tId=setTimeout(function(){$this.processScroll()},t)},getNextStory:function(){$this=this;let e=document.createElement("div");e.className="infinite_loading_outer clear";let t=document.createElement("div");t.className="ie_infinite_loading",e.appendChild(t);let r=document.createElement("div");r.className="next-auto-scroll-story";let o=document.createElement("span");o.innerText="Next Story",r.appendChild(o),jQuery("#section").append(e),jQuery("#section").append(r),void 0!==ieInfiniteScrollDetails&&void 0!==ieInfiniteScrollDetails.section&&"columns"!==ieInfiniteScrollDetails.section&&"editorials"!==ieInfiniteScrollDetails.section&&$this.createInfiniteScrollAd(),setTimeout(()=>{jQuery(".infinite_loading_outer").show(),jQuery.ajax({type:"GET",url:$this.nextStoryUrl+"?get_infinite_ajax_var=1&section="+ieInfiniteScrollDetails.section+"&last_post_id="+ieInfiniteScrollDetails.last_post_id+"&load_post_ids="+ieInfiniteScrollDetails.load_post_ids,success:function(e,t,r){if(void 0!==r.status&&200===parseInt(r.status)){let o=$this.nextStoryId,n=$this.nextStoryUrl;$this.updateUrl(o),$this.addInstagramJs(),$this.updateState("ajax"),jQuery(".infinite_loading_outer").remove(),!0===$this.recommededlogic&&$this.get_new_seo_meta(e,o);var e=e.substring(e.indexOf('<div id="getnextstoryliststart"></div>'),e.lastIndexOf('<div id="getnextstorylistend"></div>'));e=e.replace('<div id="getnextstoryliststart"></div>',""),jQuery("#section").append(DOMPurify.sanitize(e)),jQuery(".infinite_new_section .breaking-news").remove(),$this.addCss(),$this.removeSidebarWidgets("ajaxload",o),$this.totalAjaxHit=$this.totalAjaxHit+1,$this.initiateNextStorySeoMeta(o),$this.reinitiateAds(o),$this.fireEvents(n,o),$this.fireClicks(),$this.fireEvolokApiCall(),setTimeout(function(){let e=document.querySelectorAll(".lazyloading"),t=(e,t)=>{e.forEach(e=>{e.isIntersecting&&e.target.getAttribute("data-src")&&(e.target.src=e.target.getAttribute("data-src"),e.target.removeAttribute("data-src"),e.target.getAttribute("data-srcset")&&(e.target.srcset=e.target.getAttribute("data-srcset"),e.target.removeAttribute("data-srcset")),t.unobserve(e.target))})},r=new IntersectionObserver(t,{threshold:.2});e&&e.forEach(e=>{r.observe(e)}),$this.processingAjax=!1},3e3)}},error:function(e,t,r){jQuery(".infinite_loading_outer").remove(),console.log("error_in_infinite_scroll")}})},400)},updateState:function(e){$this=this,0<$this.allStories.length&&($this.nextStoryUrl=$this.allStories.pop(),$this.nextStoryId=$this.allStoriesIds.pop()),"ajax"===e&&($this.showedStories.push($this.nextStoryUrl),$this.showedStoriesIds.push($this.nextStoryId),$this.currentVisibleId=$this.nextStoryId,$this.totalNextStories=$this.totalNextStories-1)},setObserverPattern:function(e){$this=this;let t=new IntersectionObserver(e=>{if(e[0].intersectionRatio<=0)console.log("innotview");else{let t=e[0].target.getAttribute("data-postid");$this.updateUrl(t),$this.updateSeoMeta(t)}});t.observe(e)},updateUrl:function(e){$this=this,void 0!==e&&void 0!==ieInfiniteScrollDetails.posts_info[e]&&($this.browserUrl=ieInfiniteScrollDetails.posts_info[e].url,window.history.pushState("","",$this.browserUrl))},initiateNextStorySeoMeta:function(e){$this=this,$this.seoMeta[e]=ieInfiniteScrollDetails.posts_info[e].seo_meta,$this.updateSeoMeta(e),setTimeout(function(){let t=document.querySelector(".iestory_"+e);null!=t&&$this.setObserverPattern(t)},2e3)},updateSeoMeta:function(e){if($this=this,void 0!==$this.seoMeta[e]&&""!==$this.seoMeta[e]){document.getElementsByTagName("title")[0].innerText=$this.seoMeta[e].seo_title;let t=document.querySelector("meta[name=description]");"undefined"!==t&&null!==t&&document.querySelector("meta[name=description]").setAttribute("content",$this.seoMeta[e].seo_description);let r=document.querySelector("meta[name=keywords]");"undefined"!==r&&null!==r&&document.querySelector("meta[name=keywords]").setAttribute("content",$this.seoMeta[e].seo_keywords);let o=document.querySelector('meta[property="og:title"]');"undefined"!==o&&null!==o&&document.querySelector('meta[property="og:title"]').setAttribute("content",$this.seoMeta[e].og_title);let n=document.querySelector('meta[property="og:description"]');"undefined"!==n&&null!==n&&document.querySelector('meta[property="og:description"]').setAttribute("content",$this.seoMeta[e].og_description);let s=document.querySelector('meta[property="og:url"]');"undefined"!==s&&null!==s&&document.querySelector('meta[property="og:url"]').setAttribute("content",$this.seoMeta[e].og_url);let a=document.querySelector('meta[property="og:image"]');"undefined"!==a&&null!==a&&document.querySelector('meta[property="og:image"]').setAttribute("content",$this.seoMeta[e].og_image);let l=document.querySelector('meta[name="twitter:title"]');"undefined"!==l&&null!==l&&document.querySelector('meta[name="twitter:title"]').setAttribute("content",$this.seoMeta[e].tw_title);let d=document.querySelector('meta[name="twitter:description"]');"undefined"!==d&&null!==d&&document.querySelector('meta[name="twitter:description"]').setAttribute("content",$this.seoMeta[e].tw_description);let c=document.querySelector('meta[name="twitter:url"]');"undefined"!==c&&null!==c&&document.querySelector('meta[name="twitter:url"]').setAttribute("content",$this.seoMeta[e].tw_url);let u=document.querySelector('meta[name="twitter:creator"]');"undefined"!==u&&null!==u&&document.querySelector('meta[name="twitter:creator"]').setAttribute("content",$this.seoMeta[e].tw_creator);let p=document.querySelector('meta[property="twitter:image"]');"undefined"!==p&&null!==p&&document.querySelector('meta[property="twitter:image"]').setAttribute("content",$this.seoMeta[e].tw_image);let m=document.querySelector('link[rel="canonical"]');"undefined"!==m&&null!==m&&(m.href=$this.seoMeta[e].seo_canonical)}},addCss:function(){if($this=this,1===jQuery(".pdsc-related-modify").length&&!1==$this.shortCodeCss){$this.shortCodeCss=!0;var e=document.getElementsByTagName("head")[0],t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=ieInfiniteScrollDetails.siteUrl+"wp-content/themes/indianexpress/style/priority-driven-shortcode.css?ver=15042020.1",t.media="all",e.appendChild(t)}if(1===jQuery(".audio-player-tts-sec").length&&!1==$this.audioCodeCss){$this.audioCodeCss=!0;var e=document.getElementsByTagName("head")[0],t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=ieInfiniteScrollDetails.siteUrl+"wp-content/plugins/ie-aws/assets/css/audio-player.css?ver=06022023.3",t.media="all",e.appendChild(t)}jQuery(".infinite_new_section .author-tab.comments").hide()},addInstagramJs:function(){$this=this,!1===$this.instagramJs&&($this.instagramJs=!0,(scriptEle=document.createElement("script")).setAttribute("src","https://www.instagram.com/embed.js"),scriptEle.setAttribute("type","text/javascript"),scriptEle.setAttribute("async",!0),document.body.appendChild(scriptEle)),void 0!==window.instgrm&&setTimeout(function(){window.instgrm.Embeds.process()},2e3)},fireEvents:function(e,t=""){$this=this;var r="";r=e,e=e.replace(ieInfiniteScrollDetails.siteUrl,""),"undefined"!==jQuery.type(gtag)&&(gtag("event","infinite_scroll",{device:ieInfiniteScrollDetails.device,storyNumber:parseInt($this.totalAjaxHit+1)}),gtag("event","page_view",{page:e,page_location:r})),"undefined"!=typeof COMSCORE&&COMSCORE.beacon({c1:"2",c2:"8738137",c4:e}),"undefined"!=typeof pSUPERFLY&&$this.seoMeta[t]&&pSUPERFLY.virtualPage({sections:ieInfiniteScrollDetails.section,path:e,title:$this.seoMeta[t].seo_title}),$this.trackReadMoreWidgetOnInfiniteScroll(t),"undefined"!=typeof Moengage&&Moengage.track_page_view()},fireEvolokApiCall:function(){let e=sessionStorage.getItem("ua_geoip_location");"undefined"!=typeof custom_ev_data&&void 0!==e&&""!==e&&(geo_var=(geo_data=jQuery.parseJSON(e)).countryIsoCode.toLowerCase(),do_metering(custom_ev_data,geo_var,geo_city=geo_data.city.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-"),geo_state=geo_data.state.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")))},reinitiateAds:function(e){$this=this;let t="#native_story_"+e+" .ad-slot",r=document.querySelectorAll(t),o=document.querySelectorAll(t).length,n=["gpt_ad_IE_ROS_ATF_728X90","gpt_ad_IE_ROS_ROTATE_1_300X250"];for("mobile"===ieInfiniteScrollDetails.device&&(n=["gpt_ad_IE_ROS_ATF_300X250","gpt_ad_IE_ROS_BTF_300X250"]),i=0;i<o;i++){let s=r[i].getAttribute("data-id");"string"!=typeof s&&(s=r[i].getAttribute("id")),r[i].setAttribute("id",s)}setTimeout(function(){if(0<$this.ieAdCodes.length){for(AdCode in $this.ieAdCodes){let t=$this.ieAdCodes[AdCode],r=t.slot_id,o=t.slot_name,s=t.slot_size,a="#native_story_"+e+" #"+r,l=r+"_"+e;if(n.includes(r)&&(0<jQuery("#"+r).length||0<jQuery('[data-id="'+r+'"]').length)){if(0<jQuery(a).length){jQuery(a).attr("id",l);let d=googletag.defineSlot(o,s,l).addService(googletag.pubads());googletag.display(l),googletag.pubads().refresh([d])}}else 0<jQuery("#"+r).closest(".ie-adsbox").length?jQuery("#"+r).closest(".ie-adsbox").remove():0<jQuery('[data-id="'+r+'"]').closest(".ie-adsbox").length?jQuery('[data-id="'+r+'"]').closest(".ie-adsbox").remove():0<jQuery("#"+r).closest(".ads-container").length?jQuery("#"+r).closest(".ads-container").remove():0<jQuery('[data-id="'+r+'"]').closest(".ads-container").length?jQuery('[data-id="'+r+'"]').closest(".ads-container").remove():("Advertisement"===jQuery("#"+r).prev(".ie-adtext").html()||"Story continues below this ad"===jQuery("#"+r).prev(".ie-adtext").html()?(jQuery("#"+r).parent(".adboxtop").css("padding-bottom",0),jQuery("#"+r).parent(".adboxtop").css("min-height",0),jQuery("#"+r).prev(".ie-adtext").remove()):("Advertisement"===jQuery("#"+r).prev(".ie-adtext").html()||"Story continues below this ad"===jQuery('[data-id="'+r+'"]').prev(".ie-adtext").html())&&(jQuery('[data-id="'+r+'"]').parent(".adboxtop").css("padding-bottom",0),jQuery('[data-id="'+r+'"]').parent(".adboxtop").css("min-height",0),jQuery('[data-id="'+r+'"]').prev(".ie-adtext").remove()),!n.includes("gpt_ad_IE_ROS_ATF_1X1")&&0<jQuery(".osv-ad-class").length&&jQuery(".osv-ad-class").remove(),0<jQuery(".ie-int-campign-ad").length&&jQuery(".ie-int-campign-ad").remove(),jQuery("#"+r).remove(),jQuery('[data-id="'+r+'"]').remove())}void 0!==ieInfiniteScrollDetails&&void 0!==ieInfiniteScrollDetails.section&&"columns"!==ieInfiniteScrollDetails.section&&"editorials"!==ieInfiniteScrollDetails.section&&$this.renderInfiniteScrollAd(e),$this.adCounter=$this.adCounter+1}},3e3)},removeWidgets:function(){0<jQuery("#jetpack_most_read_posts_list").length&&jQuery("#jetpack_most_read_posts_list").remove()},removeSidebarWidgets:function(e,t){if("ajaxload"===e&&0<jQuery(".iestory_"+t+" .rightpanel").length&&jQuery(".iestory_"+t+" .rightpanel").empty(),1<jQuery(".iestory_"+t+" .add-first").length){let r=jQuery(".iestory_"+t+" .add-first").length;for(i=1;i<r;i++)jQuery(".iestory_"+t+" .add-first").eq(i).remove()}if(1<jQuery(".iestory_"+t+" .editor-pic").length){let o=jQuery(".iestory_"+t+" .editor-pic").length;for(i=1;i<o;i++)jQuery(".iestory_"+t+" .editor-pic").eq(i).remove()}0<jQuery(".iestory_"+t+" .h-text-widget").length&&jQuery(".iestory_"+t+" .h-text-widget").remove(),0<jQuery(".iestory_"+t+" .rhs-banner-wrapn").length&&jQuery(".iestory_"+t+" .rhs-banner-wrapn").remove(),0<jQuery(".iestory_"+t+" .latest-news.ln-type-num").length&&jQuery(".iestory_"+t+" .latest-news.ln-type-num").remove()},parseAdCodes:function(){if($this=this,"undefined"!=typeof ad_code_params&&void 0!==ad_code_params.ad_units)for(AdCode in ad_code_params.ad_units){let e=ad_code_params.ad_units[AdCode].slot_id,t=ad_code_params.ad_units[AdCode].slot_name,r=e.split("_").pop(),o=[1,1];if(void 0!==r&&-1!==r.indexOf("X")){o=(o=r.split("X")).map(Number);let n={slot_id:e,slot_name:t,slot_size:o};$this.ieAdCodes.push(n)}}},getCookie:function(e){let t=e+"=",r=decodeURIComponent(document.cookie).split(";");for(let o=0;o<r.length;o++){let n=r[o];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},async hit_recommended_api(e){if(""===e)return;let t=this.getCookie("pluuid");var r=window.location.hostname;let o=`https://devua.indianexpress.com/api/druid/article/summary?channelId=2&hour=640&articleId=${e}&limit=4&algo=2&userId=${t}`,n="https://preprod.indianexpress.com/";"indianexpress.com"==r&&(o=`https://ua.indianexpress.com/api/druid/article/summary?channelId=2&hour=640&articleId=${e}&limit=4&algo=2&userId=${t}`,n="https://indianexpress.com/");let s=new Headers;s.append("Origin",n),s.append("API-KEY","0355c2d801f6d0fee2f1977f14cc673d25d7335d2324f7e8a5db3bdfce04d0f5");try{let a=await fetch(o,{method:"GET",headers:s});if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);let l=await a.json();l=l.slice(1);let d=[],c=[],u={[e]:ieInfiniteScrollDetails.posts_info[e]};l.forEach((e,t)=>{e.articleUrl&&"string"==typeof e.articleUrl&&""!==e.articleUrl&&(d[t]=e.articleId,c[t]=e.articleUrl,u[e.articleId]={seo_meta:{},url:e.articleUrl})}),ieInfiniteScrollDetails.posts_info={},ieInfiniteScrollDetails.posts_info=u,ieInfiniteScrollDetails.posts_url=c,ieInfiniteScrollDetails.posts_ids=d}catch(p){console.error("Error fetching data:",p)}},get_new_seo_meta:function(e,t){let r=new DOMParser,o=r.parseFromString(e,"text/html").head.outerHTML;if(o){let n=r.parseFromString(o,"text/html"),s=n.querySelector("title")?.innerText??"",a=n.querySelector('meta[name="description"]')?.getAttribute("content")??"",l=n.querySelector('meta[name="keywords"]')?.getAttribute("content")??"",d=n.querySelector('meta[property="og:title"]')?.getAttribute("content")??"",c=n.querySelector('meta[property="og:description"]')?.getAttribute("content")??"",u=n.querySelector('meta[property="og:url"]')?.getAttribute("content")??"",p=n.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",m=n.querySelector('meta[property="twitter:title"]')?.getAttribute("content")??"",g=n.querySelector('meta[property="twitter:description"]')?.getAttribute("content")??"",y=n.querySelector('meta[property="twitter:url"]')?.getAttribute("content")??"",f=n.querySelector('meta[property="twitter:creator"]')?.getAttribute("content")??"",h=n.querySelector('meta[property="twitter:image"]')?.getAttribute("content")??"",S=document.querySelector('link[rel="canonical"]')?.getAttribute("href")??"";"undefined"!==s&&null!==s&&""!==s&&(document.getElementsByTagName("title")[0].innerText=s),"undefined"!==a&&null!==a&&""!==a&&document.querySelector("meta[name=description]").setAttribute("content",a),"undefined"!==l&&null!==l&&""!==l&&document.querySelector("meta[name=keywords]").setAttribute("content",l),"undefined"!==d&&null!==d&&""!==d&&document.querySelector('meta[property="og:title"]').setAttribute("content",d),"undefined"!==c&&null!==c&&""!==c&&document.querySelector('meta[property="og:description"]').setAttribute("content",c),"undefined"!==u&&null!==u&&""!==u&&document.querySelector('meta[property="og:url"]').setAttribute("content",u),"undefined"!==p&&null!==p&&""!==p&&document.querySelector('meta[property="og:image"]').setAttribute("content",p),"undefined"!==m&&null!==m&&""!==m&&document.querySelector('meta[property="twitter:title"]').setAttribute("content",m),"undefined"!==g&&null!==g&&""!==g&&document.querySelector('meta[property="twitter:description"]').setAttribute("content",g),"undefined"!==y&&null!==y&&""!==y&&document.querySelector('meta[property="twitter:url"]').setAttribute("content",y),"undefined"!==f&&null!==f&&""!==f&&document.querySelector('meta[property="twitter:creator"]').setAttribute("content",f),"undefined"!==h&&null!==h&&""!==h&&document.querySelector('meta[property="twitter:image"]').setAttribute("content",h),"undefined"!==S&&null!==S&&""!==S&&document.querySelector('link[rel="canonical"]').setAttribute("href",S),ieInfiniteScrollDetails.posts_info[t]={seo_meta:{post_id:t,seo_title:s,seo_description:a,seo_keywords:l,seo_canonical:S,seo_robots:"NOODP",og_title:d,og_description:c,og_url:u,og_image:p,tw_title:m,tw_description:g,tw_url:y,tw_creator:f,tw_image:h},url:ieInfiniteScrollDetails.posts_info[t].url}}},fireClicks:function(){$this=this,jQuery(document).on("click",".infinite_new_section .arrowDown",function(){var e=jQuery(this);e.addClass("active"),e.parent(".updating_arrow").siblings(".updated-drop-text").addClass("active")}),jQuery(document).on("click",".infinite_new_section .arrowDown.active",function(){var e=jQuery(this);e.removeClass("active"),e.parent(".updating_arrow").siblings(".updated-drop-text").removeClass("active")})},createInfiniteScrollAd:function(){$this=this;let e="sub_eoc_unique_id_"+$this.nextStoryId,t=document.createElement("div");t.id=e;let r="desktop"===ieInfiniteScrollDetails.device,o=document.createElement("div");o.className=r?"add-first":"ads-container";let n=document.createElement("div");if(n.className="ie-adtext",n.innerText="Advertisement",r)o.appendChild(n);else{let s=document.createElement("div");s.className="adboxtop adsizes",s.appendChild(n),o.appendChild(s)}t.appendChild(o),jQuery("#section").append(t)},renderInfiniteScrollAd:function(e){$this=this;let t=ieInfiniteScrollDetails.device,r="desktop"===t?"#sub_eoc_unique_id_"+e+" .add-first":"#sub_eoc_unique_id_"+e+" .ads-container .adboxtop",o="gpt_ad_IE_MOB_SUBS_EOS_300X250_"+e,n="/1050432/www.indianexpress.com/IE_mWeb_SUBS_EOS_300x250",s=[[300,250],[336,280]];if(0<jQuery(r).length){"desktop"===t&&(o="gpt_ad_IE_DESK_SUBS_EOS_300X250_"+e,n="/1050432/www.indianexpress.com/IE_Desk_SUBS_EOS_300x250",s=[300,250]);let a=document.createElement("div");a.id=o,jQuery(r).append(a);let l=googletag.defineSlot(n,s,o).addService(googletag.pubads());googletag.display(o),googletag.pubads().refresh([l])}}};jQuery(document).ready(function(){setTimeout(function(){ieInfiniteScroll.init()},2e3)});
