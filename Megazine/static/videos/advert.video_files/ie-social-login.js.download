var ieAuthorAccessToken="";var ieIsFacebookSdkLoaded=false;var ieFollowapiDomain="devua.indianexpress.com";var ieSsoapiDomain="devaccounts.indianexpress.com";var ieEvDomain="ieo.uat.evolok.net";var curr_url=location.hostname;if("indianexpress.com"===curr_url){var ieFollowapiDomain="ua.indianexpress.com";var ieSsoapiDomain="accounts.indianexpress.com";var ieEvDomain="ev.indianexpress.com"}const ieSocialLogin={containerClassHandle:"",gmailIdHandle:"",facebookIdHandle:"",emailIdHandle:"",notificationIdHandle:"",init:function(containerClassHandle,gmailIdHandle,facebookIdHandle,emailIdHandle,notificationIdHandle){if(""===containerClassHandle||""===gmailIdHandle||""===facebookIdHandle||""===emailIdHandle||""===notificationIdHandle){alert("Please provide all html handles!");return}if(0<jQuery("."+containerClassHandle).length){this.containerClassHandle=containerClassHandle;this.gmailIdHandle=gmailIdHandle;this.facebookIdHandle=facebookIdHandle;this.emailIdHandle=emailIdHandle;this.notificationIdHandle=notificationIdHandle;this.getGoogleLoginSDK();this.getFaceBookLoginSDK();this.intiateEvents()}},getGoogleLoginSDK:function(){$this=this;gapi.load("auth2",function(){auth2=gapi.auth2.init({client_id:"375995930384-dtr93riq8dq7ainlrrod84ve55f4qdgb.apps.googleusercontent.com",cookiepolicy:"single_host_origin"});$this.attachGoogleSignin(document.getElementById($this.gmailIdHandle))})},attachGoogleSignin:function(element){$this=this;var googleUser={};auth2.attachClickHandler(element,{},function(googleUser){var social_token=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token;var access_token=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse(true).access_token;$this.googleGetUserData(social_token,access_token)},function(error){console.log(JSON.stringify(error,undefined,2))})},getFaceBookLoginSDK:function(){$this=this;if(false===ieIsFacebookSdkLoaded){let loginWithFBScript=document.createElement("script");loginWithFBScript.innerHTML=`(
				function(d, s, id) {
					var js, fjs = d.getElementsByTagName( s )[0];
					if (d.getElementById( id )) {
						return;
					}
					js     = d.createElement( s );
					js.id  = id;
					js.src = '//connect.facebook.net/en_US/sdk.js';
					fjs.parentNode.insertBefore( js, fjs );
				}(document,
				'script',
				'facebook-jssdk')
			);
					window.fbAsyncInit  = function() {
						FB.init(
							{
								appId: '2223144168011709',
								cookie: true,
								status: true,
								xfbml: true,
								version: 'v3.2'
							}
						);
                    };`;document.head.append(loginWithFBScript);ieIsFacebookSdkLoaded=true}let loginWithFacebook=document.getElementById($this.facebookIdHandle);loginWithFacebook.addEventListener("click",function(e){if(undefined!==ssoUI){$this.getFBLogin("append",e)}})},emailLoginGetToken:function(payload){$this=this;$this.showLoadingimageBox();jQuery.ajax({type:"POST",url:"https://"+ieSsoapiDomain+"/api/v2/sso/login/",dataType:"json",data:JSON.stringify(payload),crossDomain:true,contentType:"application/json; charset=utf-8",headers:{"X-API-KEY":"ydDxstlJCp7a0CwCKqkwtpeptJidV6fkCnaxj51xYN7jAsgdoDtZgwVsML3Zfs9ktc9j7nlgfMEdyP3m3llagEsRAxF6rtTYeCSZ7jpg+x/gTX3htkBYttdr38Y5W2zdMN0eHyt+Qje4AWI6xog1gsJelA90VNtnm3XH3JN1LGbP3BbPUdSShWhoTYvKr9xiktc1s9r98LNI9CSBFtnA/lUZi1UzC3oQvPUmqwFzyvyb25tRKse6GVBZifWibZ1LBAgqDws9YJGG9gfAbsQKvdGeI3Fw7FJAlYkaFknq5Lmgyi9ej05/X8nMzS+L3mf1OTPuMXNOmab2W+umCrJDZg=="},beforeSend:function(){},success:function(data){if(data instanceof Object&&data.hasOwnProperty("token")&&null!==data["token"]){let exp_token=data["token"];let type=Number.isInteger(parseInt(payload.user_email,10))?"mobile":"default";$this.getEvolokSession(payload,type,exp_token)}},error:function(error){if(null!==error&&error.hasOwnProperty("status")&&error.hasOwnProperty("responseJSON")&&error["responseJSON"]instanceof Object&&error["responseJSON"].hasOwnProperty("detail")){$this.hideLoadingImagebox();$this.getInfoMsg($this.notificationIdHandle,"Please enter a valid credentials","red")}}})},getEvolokSession:function(data,type,exp_token){$this=this;var dataPayload={};dataPayload.realmName="default_realm";dataPayload.brand="IndianExpress";dataPayload.channel="WEB";if(type=="mobile"){dataPayload.authenticationSchemeName="mobile";dataPayload.identifiers=[{name:"mobile_number",value:data.user_email}]}else{dataPayload.authenticationSchemeName="default";dataPayload.identifiers=[{name:"email_address",value:data.user_email}]}dataPayload.validators=[{name:"password",value:data.user_password}];var headerPayload={Authorization:"Evolok evolok.api.service=login evolok.api.sessionId=","Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Headers":"*"};jQuery.ajax({type:"POST",dataType:"json",async:false,crossDomain:true,headers:headerPayload,url:"https://"+ieEvDomain+"/ic/api/session",data:JSON.stringify(dataPayload),success:function(result){if("yes"===on_mobile){var source_id=2}else{var source_id=1}var dataapi={channel:2,source:source_id,type:2,userGeoLocationInfo:null};ssoUI.CookieWrite("exp_token_jwt",exp_token,30,".indianexpress.com","/");jQuery.ajax({type:"POST",url:"https://"+ieFollowapiDomain+"/api/resolve/uuid",dataType:"json",data:JSON.stringify(dataapi),contentType:"application/json; charset=utf-8",xhrFields:{withCredentials:true},success:function(response){if(response.pluuid){ssoUI.CookieWrite("pluuid",response.pluuid,1,".indianexpress.com","/")}var ev_profile_lcs=localStorage.getItem("evolok:ev_session");if(null===ev_profile_lcs){localStorage.setItem("evolok:ev_session",JSON.stringify(result))}var ev_profile_lcs=localStorage.getItem("evolok:ev_session");if(null===ev_profile_lcs){localStorage.setItem("evolok:ev_session",JSON.stringify(result))}var dataResult=result;var date=new Date;if(dataResult.hasOwnProperty("mainSession")){date.setTime(dataResult.mainSession.expiry);var cookieValue="ev_ss="+dataResult.mainSession.sessionId+"; expires="+date.toGMTString()+"; path=/";cookieValue+="; domain="+window.cookie_domain;document.cookie=cookieValue}if(dataResult.hasOwnProperty("secureSession")){date.setTime(dataResult.secureSession.expiry);var cookieValue="ex_ss="+dataResult.secureSession.sessionId+"; expires="+date.toGMTString()+"; path=/";cookieValue+="; domain="+window.cookie_domain;document.cookie=cookieValue}location.reload()}})},error:function(jqXHR,textStatus,errorThrown){$this.hideLoadingImagebox();$this.getInfoMsg($this.notificationIdHandle,"Something went wrong. Try again","red")}})},getInfoMsg:function(id,msg,color){let info=document.getElementById(id);info.innerHTML=msg;info.style.display="block";info.style.color=color;if("green"===color){info.style.border="1px solid green"}},googleGetUserData:function(token,access_token){$this=this;window.ieAuthorAccessToken=access_token;dataPayload={id_token:token};$this.showLoadingimageBox();jQuery.ajax({type:"GET",dataType:"json",url:"https://oauth2.googleapis.com/tokeninfo",data:dataPayload,success:function(result){let payload={user_email:result.email,first_name:result.given_name,last_name:result.family_name,user_email_verified:"1",user_reg_channel:"g",social_id:result.sub,social_token:token,social_fb_mobile:"",inboundurl:window.location.href,outboundurl:window.location.href,loginwith:{source:location.hostname,source_type:"web",source_key:"w"}};$this.getRegistrationAndGenerateToken(payload)},error:function(error){if(null!==error&&error.hasOwnProperty("status")&&error.hasOwnProperty("responseJSON")&&error["responseJSON"]instanceof Object&&error["responseJSON"].hasOwnProperty("error_description")){$this.hideLoadingImagebox();let info=document.getElementById($this.notificationIdHandle);info.innerHTML=error["responseJSON"]["error_description"];info.style.display="inline"}}})},getRegistrationAndGenerateToken:function(payload){$this=this;jQuery.ajax({type:"POST",url:"https://"+ieSsoapiDomain+"/api/v2/sso/user/",dataType:"json",data:payload,crossDomain:true,headers:{"X-API-KEY":"ydDxstlJCp7a0CwCKqkwtpeptJidV6fkCnaxj51xYN7jAsgdoDtZgwVsML3Zfs9ktc9j7nlgfMEdyP3m3llagEsRAxF6rtTYeCSZ7jpg+x/gTX3htkBYttdr38Y5W2zdMN0eHyt+Qje4AWI6xog1gsJelA90VNtnm3XH3JN1LGbP3BbPUdSShWhoTYvKr9xiktc1s9r98LNI9CSBFtnA/lUZi1UzC3oQvPUmqwFzyvyb25tRKse6GVBZifWibZ1LBAgqDws9YJGG9gfAbsQKvdGeI3Fw7FJAlYkaFknq5Lmgyi9ej05/X8nMzS+L3mf1OTPuMXNOmab2W+umCrJDZg=="},success:function(){$this.getAccessToken(payload);$this.getInfoMsg($this.notificationIdHandle,"REGISTRATION SUCCESSFUL","green");var event_value="RegisteredUser";triggerGtmEvents(event_value)},error:function(error){if(null!==error&&error.hasOwnProperty("status")&&error.hasOwnProperty("responseJSON")&&error["responseJSON"]instanceof Object&&error["responseJSON"].hasOwnProperty("title")&&"Resource Already Exist"===error["responseJSON"]["title"]){$this.getAccessToken(payload)}else{if(payload["user_reg_channel"]==="f"){if(error.hasOwnProperty("responseJSON")&&error["responseJSON"]instanceof Object&&error["responseJSON"].hasOwnProperty("title")&&"Social account detail does not match with the given account."===error["responseJSON"]["detail"]){$this.getEvolokSessionSocial(payload["social_token"],"facebook","")}else{$this.hideLoadingImagebox();$this.getInfoMsg($this.notificationIdHandle,"Something went wrong. Try again","red")}}else{$this.hideLoadingImagebox();$this.getInfoMsg($this.notificationIdHandle,"Something went wrong. Try again","red")}}}})},getAccessToken:function(payload){$this=this;jQuery.ajax({type:"POST",url:"https://"+ieSsoapiDomain+"/api/v2/sso/login/",dataType:"json",data:payload,crossDomain:true,headers:{"X-API-KEY":"ydDxstlJCp7a0CwCKqkwtpeptJidV6fkCnaxj51xYN7jAsgdoDtZgwVsML3Zfs9ktc9j7nlgfMEdyP3m3llagEsRAxF6rtTYeCSZ7jpg+x/gTX3htkBYttdr38Y5W2zdMN0eHyt+Qje4AWI6xog1gsJelA90VNtnm3XH3JN1LGbP3BbPUdSShWhoTYvKr9xiktc1s9r98LNI9CSBFtnA/lUZi1UzC3oQvPUmqwFzyvyb25tRKse6GVBZifWibZ1LBAgqDws9YJGG9gfAbsQKvdGeI3Fw7FJAlYkaFknq5Lmgyi9ej05/X8nMzS+L3mf1OTPuMXNOmab2W+umCrJDZg=="},success:function(data){if(data instanceof Object&&data.hasOwnProperty("token")&&null!==data["token"]){let closeBtn=document.querySelectorAll(".popup-closebtn");closeBtn.forEach(btn=>btn.addEventListener("click",function(){closeLoginModel()}));let type=payload["user_reg_channel"]==="f"?"facebook":"google";let access_token=payload["user_reg_channel"]==="f"?payload["token"]:window.ieAuthorAccessToken;let exp_token=data["token"];$this.getEvolokSessionSocial(access_token,type,exp_token)}},error:function(error){if(null!==error&&error.hasOwnProperty("status")&&error.hasOwnProperty("responseJSON")&&error["responseJSON"]instanceof Object&&error["responseJSON"].hasOwnProperty("title")){$this.hideLoadingImagebox();$this.getInfoMsg($this.notificationIdHandle,"Something went wrong. Try again","red")}}})},getEvolokSessionSocial:function(data,socialType,exp_token){$this=this;if(socialType=="google"){var social_id="375995930384-dtr93riq8dq7ainlrrod84ve55f4qdgb.apps.googleusercontent.com"}else if(socialType=="facebook"){var social_id="2223144168011709"}var dataPayload={attributes:null,attributesMapping:[{name:"email_address",value:"email"},{name:"first_name",value:"firstName"},{name:"last_name",value:"lastName"}],access_token:data,client_id:social_id,realmName:"default_realm",serviceName:"registration_social"};var headerPayload={Authorization:"Evolok evolok.api.service=registration_social evolok.api.sessionId=","Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Headers":"*"};jQuery.ajax({type:"POST",dataType:"json",async:false,crossDomain:true,headers:headerPayload,url:"https://"+ieEvDomain+"/ic/api/social/"+socialType+"/session?autoRegister=true&autoPopulate=true",data:JSON.stringify(dataPayload),success:function(result){var source_id=1;if("undefined"!==typeof custom_ev_data&&"M-site"===custom_ev_data.device){source_id=2}var dataapi={channel:2,source:source_id,type:2,userGeoLocationInfo:null};ssoUI.CookieWrite("exp_token_jwt",exp_token,30,".indianexpress.com","/");jQuery.ajax({type:"POST",url:"https://"+ieFollowapiDomain+"/api/resolve/uuid",dataType:"json",data:JSON.stringify(dataapi),contentType:"application/json; charset=utf-8",xhrFields:{withCredentials:true},success:function(response){if(response.pluuid){ssoUI.CookieWrite("pluuid",response.pluuid,1,".indianexpress.com","/")}var ev_profile_lcs=localStorage.getItem("evolok:ev_session");if(null===ev_profile_lcs){localStorage.setItem("evolok:ev_session",JSON.stringify(result))}var dataResult=result;var date=new Date;if(dataResult.hasOwnProperty("mainSession")){date.setTime(dataResult.mainSession.expiry);var cookieValue="ev_ss="+dataResult.mainSession.sessionId+"; expires="+date.toGMTString()+"; path=/";cookieValue+="; domain="+window.cookie_domain;document.cookie=cookieValue}if(dataResult.hasOwnProperty("secureSession")){date.setTime(dataResult.secureSession.expiry);var cookieValue="ex_ss="+dataResult.secureSession.sessionId+"; expires="+date.toGMTString()+"; path=/";cookieValue+="; domain="+window.cookie_domain;document.cookie=cookieValue}if(socialType=="google"){}else if(socialType=="facebook"){}location.reload()}})},error:function(error){$this.hideLoadingImagebox();$this.getInfoMsg($this.notificationIdHandle,"Account is already exist with given email","red")}})},facebookGetUserData:function(token){$this=this;$this.showLoadingimageBox();FB.api("/me",{fields:"name,email"},function(result){let email=result.email;let user_name=result.name;let id=result.id;let payload={user_email:email,user_name:user_name,firstName:user_name.split(" ").slice(0,-1).join(" "),lastName:user_name.split(" ").slice(-1).join(" "),user_email_verified:"1",user_reg_channel:"f",social_id:id,social_token:token,social_fb_mobile:"",inboundurl:window.location.href,outboundurl:window.location.href,loginwith:{source:location.hostname,source_type:"web",source_key:"w"},token:token};$this.getRegistrationAndGenerateToken(payload)})},hideLoadingImagebox:function(){jQuery(".evolok_wrapper").hide()},showLoadingimageBox:function(){jQuery(".evolok_wrapper").show()},showAlert:function(message){alert(message)},getFBLogin:function(renderType,event){$this=this;event.preventDefault();if("undefined"!=typeof FB){FB.login(function(response){if(response.authResponse){var social_token=FB.getAuthResponse()["accessToken"];if(renderType=="append"){$this.facebookGetUserData(social_token)}else{if(ssoUI.is_mobile_ssoie){var signuplink="&is_premium=yes&premium_mode=premium_mobile"}else{var signuplink="&is_premium=yes&premium_mode=premium_desktop"}window.location.href=ssoUI.site_url+"/oauth2/authorize/"+ssoUI.qstring()+"&fbcredential="+social_token+signuplink}}},{scope:"email,public_profile",return_scopes:true})}else{console.log("singlesign FB sdk not loaded")}return false},intiateEvents:function(){$this=this;let gmailButton=document.getElementById($this.gmailIdHandle);let facebookButton=document.getElementById($this.facebookIdHandle);let emailButton=document.getElementById($this.emailIdHandle);let device="Mobile";if("Desktop"===custom_ev_data.device){device="Desktop"}if("undefined"!==typeof custom_ev_data&&"undefined"!==typeof ga&&"undefined"!==typeof gmailButton&&"undefined"!==typeof facebookButton&&"undefined"!==typeof Moengage){gmailButton.addEventListener("click",function(){$this.fireEvents("google",device)});facebookButton.addEventListener("click",function(){$this.fireEvents("facebook",device)});emailButton.addEventListener("click",function(){$this.fireEvents("email",device)})}},fireEvents:function(type,device){$this=this;var clickLocation="datawall";if("undefined"!==typeof $this.gmailIdHandle&&""!==$this.gmailIdHandle&&"cus_gmaillogin_evolok_notifier"===$this.gmailIdHandle){clickLocation="notifier"}let eventObject={page_name:"article",page_section:custom_ev_data.section,click_trigger_name:type+"_"+clickLocation+"_signup",click_action:"User tried to Sign Up By "+device,event_action:"clicked"};Moengage.track_event(type+"_"+clickLocation+"_signup",eventObject)}};window.addEventListener("load",function(){setTimeout(function(){ieSocialLogin.init("evolok_social_login","cus_gmaillogin_evolok","cus_FBlogin_evolok","cus_emaillogin_evolok","form-msg-dialog-evolok");ieSocialLogin.init("evolok_social_login_notifier","cus_gmaillogin_evolok_notifier","cus_FBlogin_evolok_notifier","cus_emaillogin_evolok_notifier","form-msg-dialog-evolok-notifier");ieSocialLogin.init("evolok_social_login_epaper","cus_gmaillogin_evolok_epaper","cus_FBlogin_evolok_epaper","cus_emaillogin_evolok_epaper","form-msg-dialog-evolok-epaper")},3e3)});function triggerGtmEvents(event_value){var dataLayer=window.dataLayer=window.dataLayer||[];dataLayer.push({event:event_value});console.log(event_value+" event triggered successfully")}
